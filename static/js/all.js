var qrcode=function(){function t(e,n){if(e.length===void 0)throw Error(e.length+"/"+n);var i=function(){for(var t=0;e.length>t&&0==e[t];)t+=1;for(var i=Array(e.length-t+n),r=0;e.length-t>r;r+=1)i[r]=e[r+t];return i}(),r={};return r.getAt=function(t){return i[t]},r.getLength=function(){return i.length},r.multiply=function(e){for(var n=Array(r.getLength()+e.getLength()-1),i=0;r.getLength()>i;i+=1)for(var o=0;e.getLength()>o;o+=1)n[i+o]^=s.gexp(s.glog(r.getAt(i))+s.glog(e.getAt(o)));return t(n,0)},r.mod=function(e){if(0>r.getLength()-e.getLength())return r;for(var n=s.glog(r.getAt(0))-s.glog(e.getAt(0)),i=Array(r.getLength()),o=0;r.getLength()>o;o+=1)i[o]=r.getAt(o);for(var o=0;e.getLength()>o;o+=1)i[o]^=s.gexp(s.glog(e.getAt(o))+n);return t(i,0).mod(e)},r}var e=function(e,n){var r=236,s=17,c=e,f=i[n],l=null,d=0,g=null,p=[],m={},y=function(t,e){d=4*c+17,l=function(t){for(var e=Array(t),n=0;t>n;n+=1){e[n]=Array(t);for(var i=0;t>i;i+=1)e[n][i]=null}return e}(d),_(0,0),_(d-7,0),_(0,d-7),k(),S(),x(t,e),c>=7&&b(t),null==g&&(g=T(c,f,p)),E(g,e)},_=function(t,e){for(var n=-1;7>=n;n+=1)if(!(-1>=t+n||t+n>=d))for(var i=-1;7>=i;i+=1)-1>=e+i||e+i>=d||(l[t+n][e+i]=n>=0&&6>=n&&(0==i||6==i)||i>=0&&6>=i&&(0==n||6==n)||n>=2&&4>=n&&i>=2&&4>=i?!0:!1)},w=function(){for(var t=0,e=0,n=0;8>n;n+=1){y(!0,n);var i=o.getLostPoint(m);(0==n||t>i)&&(t=i,e=n)}return e},S=function(){for(var t=8;d-8>t;t+=1)null==l[t][6]&&(l[t][6]=0==t%2);for(var e=8;d-8>e;e+=1)null==l[6][e]&&(l[6][e]=0==e%2)},k=function(){for(var t=o.getPatternPosition(c),e=0;t.length>e;e+=1)for(var n=0;t.length>n;n+=1){var i=t[e],r=t[n];if(null==l[i][r])for(var s=-2;2>=s;s+=1)for(var a=-2;2>=a;a+=1)l[i+s][r+a]=-2==s||2==s||-2==a||2==a||0==s&&0==a?!0:!1}},b=function(t){for(var e=o.getBCHTypeNumber(c),n=0;18>n;n+=1){var i=!t&&1==(1&e>>n);l[Math.floor(n/3)][n%3+d-8-3]=i}for(var n=0;18>n;n+=1){var i=!t&&1==(1&e>>n);l[n%3+d-8-3][Math.floor(n/3)]=i}},x=function(t,e){for(var n=f<<3|e,i=o.getBCHTypeInfo(n),r=0;15>r;r+=1){var s=!t&&1==(1&i>>r);6>r?l[r][8]=s:8>r?l[r+1][8]=s:l[d-15+r][8]=s}for(var r=0;15>r;r+=1){var s=!t&&1==(1&i>>r);8>r?l[8][d-r-1]=s:9>r?l[8][15-r-1+1]=s:l[8][15-r-1]=s}l[d-8][8]=!t},E=function(t,e){for(var n=-1,i=d-1,r=7,s=0,a=o.getMaskFunction(e),h=d-1;h>0;h-=2)for(6==h&&(h-=1);;){for(var u=0;2>u;u+=1)if(null==l[i][h-u]){var c=!1;t.length>s&&(c=1==(1&t[s]>>>r));var f=a(i,h-u);f&&(c=!c),l[i][h-u]=c,r-=1,-1==r&&(s+=1,r=7)}if(i+=n,0>i||i>=d){i-=n,n=-n;break}}},M=function(e,n){for(var i=0,r=0,s=0,a=Array(n.length),h=Array(n.length),u=0;n.length>u;u+=1){var c=n[u].dataCount,f=n[u].totalCount-c;r=Math.max(r,c),s=Math.max(s,f),a[u]=Array(c);for(var l=0;a[u].length>l;l+=1)a[u][l]=255&e.getBuffer()[l+i];i+=c;var d=o.getErrorCorrectPolynomial(f),v=t(a[u],d.getLength()-1),g=v.mod(d);h[u]=Array(d.getLength()-1);for(var l=0;h[u].length>l;l+=1){var p=l+g.getLength()-h[u].length;h[u][l]=p>=0?g.getAt(p):0}}for(var m=0,l=0;n.length>l;l+=1)m+=n[l].totalCount;for(var y=Array(m),_=0,l=0;r>l;l+=1)for(var u=0;n.length>u;u+=1)a[u].length>l&&(y[_]=a[u][l],_+=1);for(var l=0;s>l;l+=1)for(var u=0;n.length>u;u+=1)h[u].length>l&&(y[_]=h[u][l],_+=1);return y},T=function(t,e,n){for(var i=a.getRSBlocks(t,e),u=h(),c=0;n.length>c;c+=1){var f=n[c];u.put(f.getMode(),4),u.put(f.getLength(),o.getLengthInBits(f.getMode(),t)),f.write(u)}for(var l=0,c=0;i.length>c;c+=1)l+=i[c].dataCount;if(u.getLengthInBits()>8*l)throw Error("code length overflow. ("+u.getLengthInBits()+">"+8*l+")");for(8*l>=u.getLengthInBits()+4&&u.put(0,4);0!=u.getLengthInBits()%8;)u.putBit(!1);for(;;){if(u.getLengthInBits()>=8*l)break;if(u.put(r,8),u.getLengthInBits()>=8*l)break;u.put(s,8)}return M(u,i)};return m.addData=function(t){var e=u(t);p.push(e),g=null},m.isDark=function(t,e){if(0>t||t>=d||0>e||e>=d)throw Error(t+","+e);return l[t][e]},m.getModuleCount=function(){return d},m.make=function(){y(!1,w())},m.createTableTag=function(t,e){t=t||2,e=e===void 0?4*t:e;var n="";n+='<table style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: "+e+"px;",n+='">',n+="<tbody>";for(var i=0;m.getModuleCount()>i;i+=1){n+="<tr>";for(var r=0;m.getModuleCount()>r;r+=1)n+='<td style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: 0px;",n+=" width: "+t+"px;",n+=" height: "+t+"px;",n+=" background-color: ",n+=m.isDark(i,r)?"#000000":"#ffffff",n+=";",n+='"/>';n+="</tr>"}return n+="</tbody>",n+="</table>"},m.createImgTag=function(t,e){t=t||2,e=e===void 0?4*t:e;var n=m.getModuleCount()*t+2*e,i=e,r=n-e;return v(n,n,function(e,n){if(e>=i&&r>e&&n>=i&&r>n){var o=Math.floor((e-i)/t),s=Math.floor((n-i)/t);return m.isDark(s,o)?0:1}return 1})},m};e.stringToBytes=function(t){for(var e=[],n=0;t.length>n;n+=1){var i=t.charCodeAt(n);e.push(255&i)}return e},e.createStringToBytes=function(t,e){var n=function(){for(var n=l(t),i=function(){var t=n.read();if(-1==t)throw Error();return t},r=0,o={};;){var s=n.read();if(-1==s)break;var a=i(),h=i(),u=i(),c=String.fromCharCode(s<<8|a),f=h<<8|u;o[c]=f,r+=1}if(r!=e)throw Error(r+" != "+e);return o}(),i="?".charCodeAt(0);return function(t){for(var e=[],r=0;t.length>r;r+=1){var o=t.charCodeAt(r);if(128>o)e.push(o);else{var s=n[t.charAt(r)];"number"==typeof s?(255&s)==s?e.push(s):(e.push(s>>>8),e.push(255&s)):e.push(i)}}return e}};var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},i={L:1,M:0,Q:3,H:2},r={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o=function(){var e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],i=1335,o=7973,a=21522,h={},u=function(t){for(var e=0;0!=t;)e+=1,t>>>=1;return e};return h.getBCHTypeInfo=function(t){for(var e=t<<10;u(e)-u(i)>=0;)e^=i<<u(e)-u(i);return(t<<10|e)^a},h.getBCHTypeNumber=function(t){for(var e=t<<12;u(e)-u(o)>=0;)e^=o<<u(e)-u(o);return t<<12|e},h.getPatternPosition=function(t){return e[t-1]},h.getMaskFunction=function(t){switch(t){case r.PATTERN000:return function(t,e){return 0==(t+e)%2};case r.PATTERN001:return function(t){return 0==t%2};case r.PATTERN010:return function(t,e){return 0==e%3};case r.PATTERN011:return function(t,e){return 0==(t+e)%3};case r.PATTERN100:return function(t,e){return 0==(Math.floor(t/2)+Math.floor(e/3))%2};case r.PATTERN101:return function(t,e){return 0==t*e%2+t*e%3};case r.PATTERN110:return function(t,e){return 0==(t*e%2+t*e%3)%2};case r.PATTERN111:return function(t,e){return 0==(t*e%3+(t+e)%2)%2};default:throw Error("bad maskPattern:"+t)}},h.getErrorCorrectPolynomial=function(e){for(var n=t([1],0),i=0;e>i;i+=1)n=n.multiply(t([1,s.gexp(i)],0));return n},h.getLengthInBits=function(t,e){if(e>=1&&10>e)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw Error("mode:"+t)}else if(27>e)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw Error("mode:"+t)}else{if(!(41>e))throw Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw Error("mode:"+t)}}},h.getLostPoint=function(t){for(var e=t.getModuleCount(),n=0,i=0;e>i;i+=1)for(var r=0;e>r;r+=1){for(var o=0,s=t.isDark(i,r),a=-1;1>=a;a+=1)if(!(0>i+a||i+a>=e))for(var h=-1;1>=h;h+=1)0>r+h||r+h>=e||(0!=a||0!=h)&&s==t.isDark(i+a,r+h)&&(o+=1);o>5&&(n+=3+o-5)}for(var i=0;e-1>i;i+=1)for(var r=0;e-1>r;r+=1){var u=0;t.isDark(i,r)&&(u+=1),t.isDark(i+1,r)&&(u+=1),t.isDark(i,r+1)&&(u+=1),t.isDark(i+1,r+1)&&(u+=1),(0==u||4==u)&&(n+=3)}for(var i=0;e>i;i+=1)for(var r=0;e-6>r;r+=1)t.isDark(i,r)&&!t.isDark(i,r+1)&&t.isDark(i,r+2)&&t.isDark(i,r+3)&&t.isDark(i,r+4)&&!t.isDark(i,r+5)&&t.isDark(i,r+6)&&(n+=40);for(var r=0;e>r;r+=1)for(var i=0;e-6>i;i+=1)t.isDark(i,r)&&!t.isDark(i+1,r)&&t.isDark(i+2,r)&&t.isDark(i+3,r)&&t.isDark(i+4,r)&&!t.isDark(i+5,r)&&t.isDark(i+6,r)&&(n+=40);for(var c=0,r=0;e>r;r+=1)for(var i=0;e>i;i+=1)t.isDark(i,r)&&(c+=1);var f=Math.abs(100*c/e/e-50)/5;return n+=10*f},h}(),s=function(){for(var t=Array(256),e=Array(256),n=0;8>n;n+=1)t[n]=1<<n;for(var n=8;256>n;n+=1)t[n]=t[n-4]^t[n-5]^t[n-6]^t[n-8];for(var n=0;255>n;n+=1)e[t[n]]=n;var i={};return i.glog=function(t){if(1>t)throw Error("glog("+t+")");return e[t]},i.gexp=function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return t[e]},i}(),a=function(){var t=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16]],e=function(t,e){var n={};return n.totalCount=t,n.dataCount=e,n},n={},r=function(e,n){switch(n){case i.L:return t[4*(e-1)+0];case i.M:return t[4*(e-1)+1];case i.Q:return t[4*(e-1)+2];case i.H:return t[4*(e-1)+3];default:return void 0}};return n.getRSBlocks=function(t,n){var i=r(t,n);if(i===void 0)throw Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+n);for(var o=i.length/3,s=[],a=0;o>a;a+=1)for(var h=i[3*a+0],u=i[3*a+1],c=i[3*a+2],f=0;h>f;f+=1)s.push(e(u,c));return s},n}(),h=function(){var t=[],e=0,n={};return n.getBuffer=function(){return t},n.getAt=function(e){var n=Math.floor(e/8);return 1==(1&t[n]>>>7-e%8)},n.put=function(t,e){for(var i=0;e>i;i+=1)n.putBit(1==(1&t>>>e-i-1))},n.getLengthInBits=function(){return e},n.putBit=function(n){var i=Math.floor(e/8);i>=t.length&&t.push(0),n&&(t[i]|=128>>>e%8),e+=1},n},u=function(t){var i=n.MODE_8BIT_BYTE,r=e.stringToBytes(t),o={};return o.getMode=function(){return i},o.getLength=function(){return r.length},o.write=function(t){for(var e=0;r.length>e;e+=1)t.put(r[e],8)},o},c=function(){var t=[],e={};return e.writeByte=function(e){t.push(255&e)},e.writeShort=function(t){e.writeByte(t),e.writeByte(t>>>8)},e.writeBytes=function(t,n,i){n=n||0,i=i||t.length;for(var r=0;i>r;r+=1)e.writeByte(t[r+n])},e.writeString=function(t){for(var n=0;t.length>n;n+=1)e.writeByte(t.charCodeAt(n))},e.toByteArray=function(){return t},e.toString=function(){var e="";e+="[";for(var n=0;t.length>n;n+=1)n>0&&(e+=","),e+=t[n];return e+="]"},e},f=function(){var t=0,e=0,n=0,i="",r={},o=function(t){i+=String.fromCharCode(s(63&t))},s=function(t){if(0>t);else{if(26>t)return 65+t;if(52>t)return 97+(t-26);if(62>t)return 48+(t-52);if(62==t)return 43;if(63==t)return 47}throw Error("n:"+t)};return r.writeByte=function(i){for(t=t<<8|255&i,e+=8,n+=1;e>=6;)o(t>>>e-6),e-=6},r.flush=function(){if(e>0&&(o(t<<6-e),t=0,e=0),0!=n%3)for(var r=3-n%3,s=0;r>s;s+=1)i+="="},r.toString=function(){return i},r},l=function(t){var e=t,n=0,i=0,r=0,o={};o.read=function(){for(;8>r;){if(n>=e.length){if(0==r)return-1;throw Error("unexpected end of file./"+r)}var t=e.charAt(n);if(n+=1,"="==t)return r=0,-1;t.match(/^\s$/)||(i=i<<6|s(t.charCodeAt(0)),r+=6)}var o=255&i>>>r-8;return r-=8,o};var s=function(t){if(t>=65&&90>=t)return t-65;if(t>=97&&122>=t)return t-97+26;if(t>=48&&57>=t)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw Error("c:"+t)};return o},d=function(t,e){var n=t,i=e,r=Array(t*e),o={};o.setPixel=function(t,e,i){r[e*n+t]=i},o.write=function(t){t.writeString("GIF87a"),t.writeShort(n),t.writeShort(i),t.writeByte(128),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(255),t.writeByte(255),t.writeByte(255),t.writeString(","),t.writeShort(0),t.writeShort(0),t.writeShort(n),t.writeShort(i),t.writeByte(0);var e=2,r=a(e);t.writeByte(e);for(var o=0;r.length-o>255;)t.writeByte(255),t.writeBytes(r,o,255),o+=255;t.writeByte(r.length-o),t.writeBytes(r,o,r.length-o),t.writeByte(0),t.writeString(";")};var s=function(t){var e=t,n=0,i=0,r={};return r.write=function(t,r){if(0!=t>>>r)throw Error("length over");for(;n+r>=8;)e.writeByte(255&(t<<n|i)),r-=8-n,t>>>=8-n,i=0,n=0;i=t<<n|i,n+=r},r.flush=function(){n>0&&e.writeByte(i)},r},a=function(t){for(var e=1<<t,n=(1<<t)+1,i=t+1,o=h(),a=0;e>a;a+=1)o.add(String.fromCharCode(a));o.add(String.fromCharCode(e)),o.add(String.fromCharCode(n));var u=c(),f=s(u);f.write(e,i);var l=0,d=String.fromCharCode(r[l]);for(l+=1;r.length>l;){var v=String.fromCharCode(r[l]);l+=1,o.contains(d+v)?d+=v:(f.write(o.indexOf(d),i),4095>o.size()&&(o.size()==1<<i&&(i+=1),o.add(d+v)),d=v)}return f.write(o.indexOf(d),i),f.write(n,i),f.flush(),u.toByteArray()},h=function(){var t={},e=0,n={};return n.add=function(i){if(n.contains(i))throw Error("dup key:"+i);t[i]=e,e+=1},n.size=function(){return e},n.indexOf=function(e){return t[e]},n.contains=function(e){return t[e]!==void 0},n};return o},v=function(t,e,n,i){for(var r=d(t,e),o=0;e>o;o+=1)for(var s=0;t>s;s+=1)r.setPixel(s,o,n(s,o));var a=c();r.write(a);for(var h=f(),u=a.toByteArray(),l=0;u.length>l;l+=1)h.writeByte(u[l]);h.flush();var v="";return v+="<img",v+=' src="',v+="data:image/gif;base64,",v+=h,v+='"',v+=' width="',v+=t,v+='"',v+=' height="',v+=e,v+='"',i&&(v+=' alt="',v+=i,v+='"'),v+="/>"};return e}();(function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else Q=t()})(function(){"use strict";function t(t){var e=Function.call;return function(){return e.apply(t,arguments)}}function e(t){return"[object StopIteration]"===ae(t)||t instanceof Z}function n(t,e){e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(he)&&(t.stack=i(t.stack)+"\n"+he+"\n"+i(e.stack))}function i(t){for(var e=t.split("\n"),n=[],i=0;e.length>i;++i){var s=e[i];o(s)||r(s)||n.push(s)}return n.join("\n")}function r(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function o(t){var e=/at .+ \((.*):(\d+):\d+\)/.exec(t);if(!e)return!1;var n=e[1],i=e[2];return n===J&&i>=G&&de>=i}function s(){if(Error.captureStackTrace){var t,e,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,i){t=i[1].getFileName(),e=i[1].getLineNumber()},Error().stack,Error.prepareStackTrace=n,J=t,e}}function a(t){return w(t)}function h(){function t(t){e=t,ee(n,function(e,n){X(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,i=void 0}var e,n=[],i=[],r=re(h.prototype),o=re(c.prototype);return o.promiseDispatch=function(t,r,o){var s=te(arguments);n?(n.push(s),"when"===r&&o[1]&&i.push(o[1])):X(function(){e.promiseDispatch.apply(e,s)})},o.valueOf=function(){if(n)return o;var t=f(e);return l(t)&&(e=t),t},Error.captureStackTrace&&a.longStackJumpLimit>0&&(Error.captureStackTrace(o,h),o.stack=o.stack.substring(o.stack.indexOf("\n")+1)),r.promise=o,r.resolve=function(n){e||t(w(n))},r.fulfill=function(n){e||t(_(n))},r.reject=function(n){e||t(y(n))},r.notify=function(t){e||ee(i,function(e,n){X(function(){n(t)})},void 0)},r}function u(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=h();return B(t,e.resolve,e.reject,e.notify).fail(e.reject),e.promise}function c(t,e,n,i,r){void 0===e&&(e=function(t){return y(Error("Promise does not support operation: "+t))});var o=re(c.prototype);return o.promiseDispatch=function(n,i,r){var s;try{s=t[i]?t[i].apply(o,r):e.call(o,i,r)}catch(a){s=y(a)}n&&n(s)},n&&(o.valueOf=n),r&&(o.exception=i),o}function f(t){return l(t)?t.valueOf():t}function l(t){return t&&"function"==typeof t.promiseDispatch}function d(t){return t&&"function"==typeof t.then}function v(t){return!g(t)&&!p(t)}function g(t){return!d(f(t))}function p(t){return t=f(t),l(t)&&"exception"in t}function m(){fe||"undefined"==typeof window||window.Touch||!window.console||console.warn("[Q] Unhandled rejection reasons (should be empty):",ue),fe=!0}function y(t){var e=c({when:function(e){if(e){var n=ne(ce,this);-1!==n&&(ce.splice(n,1),ue.splice(n,1))}return e?e(t):this}},function(){return y(t)},function(){return this},t,!0);return m(),ce.push(e),ue.push(t),e}function _(t){return c({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return se(t)}},void 0,function(){return t})}function w(t){return l(t)?t:(t=f(t),d(t)?S(t):_(t))}function S(t){var e=h();return X(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}}),e.promise}function k(t){return c({isDef:function(){}},function(e,n){return C(t,e,n)},function(){return f(t)})}function b(t,e,i,r){function o(t){try{return"function"==typeof e?e(t):t}catch(n){return y(n)}}function s(t){if("function"==typeof i){n(t,l);try{return i(t)}catch(e){return y(e)}}return y(t)}function u(t){return"function"==typeof r?r(t):t}var c=h(),f=!1,l=w(t);return X(function(){l.promiseDispatch(function(t){f||(f=!0,c.resolve(o(t)))},"when",[function(t){f||(f=!0,c.resolve(s(t)))}])}),l.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=u(t)}catch(i){if(n=!0,!a.onerror)throw i;a.onerror(i)}n||c.notify(e)}]),c.promise}function x(t,e,n){return b(t,function(t){return L(t).then(function(t){return e.apply(void 0,t)},n)},n)}function E(t){return function(){function n(t,n){var s;try{s=i[t](n)}catch(a){return e(a)?a.value:y(a)}return b(s,r,o)}var i=t.apply(this,arguments),r=n.bind(n,"send"),o=n.bind(n,"throw");return r()}}function M(t){throw new Z(t)}function T(t){return function(){return x([this,L(arguments)],function(e,n){return t.apply(e,n)})}}function C(t,e,n){var i=h();return X(function(){w(t).promiseDispatch(i.resolve,e,n)}),i.promise}function A(t){return function(e){var n=te(arguments,1);return C(e,t,n)}}function j(t,e){var n=te(arguments,2);return le(t,e,n)}function P(t,e){return C(t,"apply",[void 0,e])}function B(t){var e=te(arguments,1);return P(t,e)}function I(t){var e=te(arguments,1);return function(){var n=e.concat(te(arguments));return C(t,"apply",[this,n])}}function L(t){return b(t,function(t){var e=0,n=h();return ee(t,function(i,r,o){g(r)?t[o]=f(r):(++e,b(r,function(i){t[o]=i,0===--e&&n.resolve(t)},n.reject))},void 0),0===e&&n.resolve(t),n.promise})}function O(t){return b(t,function(t){return t=ie(t,w),b(L(ie(t,function(t){return b(t,$,$)})),function(){return t})})}function D(t,e){return b(t,void 0,e)}function R(t,e){return b(t,void 0,void 0,e)}function N(t,e){return b(t,function(t){return b(e(),function(){return t})},function(t){return b(e(),function(){return y(t)})})}function H(t,e,i,r){var o=function(e){X(function(){if(n(e,t),!a.onerror)throw e;a.onerror(e)})},s=e||i||r?b(t,e,i,r):t;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),D(s,o)}function q(t,e,n){var i=h(),r=setTimeout(function(){i.reject(Error(n||"Timed out after "+e+" ms"))},e);return b(t,function(t){clearTimeout(r),i.resolve(t)},function(t){clearTimeout(r),i.reject(t)},i.notify),i.promise}function z(t,e){void 0===e&&(e=t,t=void 0);var n=h();return b(t,void 0,void 0,n.notify),setTimeout(function(){n.resolve(t)},e),n.promise}function Q(t,e){var n=te(e),i=h();return n.push(i.makeNodeResolver()),P(t,n).fail(i.reject),i.promise}function F(t){var e=te(arguments,1),n=h();return e.push(n.makeNodeResolver()),P(t,e).fail(n.reject),n.promise}function W(t){var e=te(arguments,1);return function(){var n=e.concat(te(arguments)),i=h();return n.push(i.makeNodeResolver()),P(t,n).fail(i.reject),i.promise}}function V(t,e){var n=te(arguments,2);return function(){function i(){return t.apply(e,arguments)}var r=n.concat(te(arguments)),o=h();return r.push(o.makeNodeResolver()),P(i,r).fail(o.reject),o.promise}}function U(t,e,n){var i=te(n||[]),r=h();return i.push(r.makeNodeResolver()),le(t,e,i).fail(r.reject),r.promise}function Y(t,e){var n=te(arguments,2),i=h();return n.push(i.makeNodeResolver()),le(t,e,n).fail(i.reject),i.promise}function K(t,e){return e?(t.then(function(t){X(function(){e(null,t)})},function(t){X(function(){e(t)})}),void 0):t}var J,X,G=s(),$=function(){};"function"==typeof setImmediate?X="undefined"!=typeof window?setImmediate.bind(window):setImmediate:"undefined"!=typeof process&&process.nextTick?X=process.nextTick:function(){function t(){if(--r,++s>=i){s=0,i*=4;for(var t=o&&Math.min(o-1,i);t>r;)++r,a()}for(;o;){--o,e=e.next;var n=e.task;e.task=void 0,n()}s=0}var e={task:void 0,next:null},n=e,i=2,r=0,o=0,s=0,a=void 0;if(X=function(t){n=n.next={task:t,next:null},++o>r&&i>r&&(++r,a())},"undefined"!=typeof MessageChannel){var h=new MessageChannel;h.port1.onmessage=t,a=function(){h.port2.postMessage(0)}}else a=function(){setTimeout(t,0)}}();var Z,te=t(Array.prototype.slice),ee=t(Array.prototype.reduce||function(t,e){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(e=t(e,this[n],n));return e}),ne=t(Array.prototype.indexOf||function(t){for(var e=0;this.length>e;e++)if(this[e]===t)return e;return-1}),ie=t(Array.prototype.map||function(t,e){var n=this,i=[];return ee(n,function(r,o,s){i.push(t.call(e,o,s,n))},void 0),i}),re=Object.create||function(t){function e(){}return e.prototype=t,new e},oe=t(Object.prototype.hasOwnProperty),se=Object.keys||function(t){var e=[];for(var n in t)oe(t,n)&&e.push(n);return e},ae=t(Object.prototype.toString);Z="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t},a.longStackJumpLimit=1;var he="From previous event:";a.nextTick=X,a.defer=h,h.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve(te(arguments,1)):t.resolve(n)}},a.promise=u,a.makePromise=c,c.prototype.then=function(t,e,n){return b(this,t,e,n)},c.prototype.thenResolve=function(t){return b(this,function(){return t})},c.prototype.thenReject=function(t){return b(this,function(){throw t})},ee(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","npost","nsend","ninvoke","nodeify"],function(t,e){c.prototype[e]=function(){return a[e].apply(a,[this].concat(te(arguments)))}},void 0),c.prototype.toSource=function(){return""+this},c.prototype.toString=function(){return"[object Promise]"},a.nearer=f,a.isPromise=l,a.isPromiseAlike=d,a.isPending=v,a.isFulfilled=g,a.isRejected=p;var ue=a.unhandledReasons=[],ce=[],fe=!1;"undefined"!=typeof process&&process.on&&process.on("exit",function(){for(var t=0;ue.length>t;t++){var e=ue[t];e&&e.stack!==void 0?console.warn("Unhandled rejection reason:",e.stack):console.warn("Unhandled rejection reason (no stack):",e)}}),a.reject=y,a.fulfill=_,a.resolve=w,a.master=k,a.when=b,a.spread=x,a.async=E,a["return"]=M,a.promised=T,a.dispatch=C,a.dispatcher=A,a.get=A("get"),a.set=A("set"),a["delete"]=a.del=A("delete");var le=a.post=A("post");a.send=j,a.invoke=j,a.fapply=P,a["try"]=B,a.fcall=B,a.fbind=I,a.keys=A("keys"),a.all=L,a.allResolved=O,a["catch"]=a.fail=D,a.progress=R,a["finally"]=a.fin=N,a.done=H,a.timeout=q,a.delay=z,a.nfapply=Q,a.nfcall=F,a.nfbind=W,a.denodeify=a.nfbind,a.nbind=V,a.npost=U,a.nsend=Y,a.ninvoke=a.nsend,a.nodeify=K;var de=s();return a});var EventEmitter=function(){};EventEmitter.prototype={on:function(t,e){return this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e),this},one:function(t,e){function n(){e.apply(this,arguments),i.off(t,n),delete e.wrappedFct}var i=this;return e.wrappedFct=n,this.on(t,n)},off:function(t,e){return t?e?(e=e.wrappedFct||e,this._events=this._events||{},t in this._events==!1?this:(this._events[t].splice(this._events[t].indexOf(e),1),this)):(delete this._events[t],this):(delete this._events,this)},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1){for(var e=0;this._events[t].length>e;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1));return this}}};var ji={};(function(){var t={},e={easeInQuad:"cubic-bezier(0.550, 0.085, 0.680, 0.530)",easeInCubic:"cubic-bezier(0.550, 0.055, 0.675, 0.190)",easeInQuart:"cubic-bezier(0.895, 0.030, 0.685, 0.220)",easeInQuint:"cubic-bezier(0.755, 0.050, 0.855, 0.060)",easeInSine:"cubic-bezier(0.470, 0.000, 0.745, 0.715)",easeInExpo:"cubic-bezier(0.950, 0.050, 0.795, 0.035)",easeInCirc:"cubic-bezier(0.600, 0.040, 0.980, 0.335)",easeOutQuad:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",easeOutCubic:"cubic-bezier(0.215, 0.610, 0.355, 1.000)",easeOutQuart:"cubic-bezier(0.165, 0.840, 0.440, 1.000)",easeOutQuint:"cubic-bezier(0.230, 1.000, 0.320, 1.000)",easeOutSine:"cubic-bezier(0.390, 0.575, 0.565, 1.000)",easeOutExpo:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",easeOutCirc:"cubic-bezier(0.075, 0.820, 0.165, 1.000)",easeInOutQuad:"cubic-bezier(0.455, 0.030, 0.515, 0.955)",easeInOutCubic:"cubic-bezier(0.645, 0.045, 0.355, 1.000)",easeInOutQuart:"cubic-bezier(0.770, 0.000, 0.175, 1.000)",easeInOutQuint:"cubic-bezier(0.860, 0.000, 0.070, 1.000)",easeInOutSine:"cubic-bezier(0.445, 0.050, 0.550, 0.950)",easeInOutExpo:"cubic-bezier(1.000, 0.000, 0.000, 1.000)",easeInOutCirc:"cubic-bezier(0.785, 0.135, 0.150, 0.860)"},n=["transitionend","webkitTransitionEnd","oTransitionEnd"],i=function(){var t=document.body.style,e=["Webkit","O","Ms","Moz"],n={};return function(i){if(i in n)return n[i];var r,o="",s=e.length,a=i.replace(/-([a-z])/gi,function(t,e){return e.toUpperCase()});if(a in t)o=i;else for(r=a.slice(0,1).toUpperCase()+a.slice(1);s--;)if(e[s]+r in t){o=e[s]+r;break}return n[i]=o}}();t.css=function(t,e,n){t.style[i(e)]=n},t.transition=function(t,r,o,s){function a(e){e.target==t&&(n.forEach(function(e){t.removeEventListener(e,a)}),t.style[i("transition")]="",t.offsetWidth,l.resolve())}var h,u,c={},f="",l=Q.defer();for(u in r)h=i(u),h&&(c[u]=r[u],f+=(f?",":"")+u);t.offsetWidth,n.forEach(function(e){t.addEventListener(e,a)}),t.style[i("transition")]="all "+o+"s "+(e[s||"easeInOutQuad"]||s),t.style[i("transition-property")]=f;for(u in c)t.style[i(u)]=c[u];return l.promise},t.formatTime=function(t){var e=Math.floor(t/6e4);t%=6e4;var n=Math.floor(t/1e3),i=Math.floor(t%1e3);return e+":"+(10>n?"0"+n:n)+"."+(10>i?"00"+i:100>i?"0"+i:i)},ji.utils=t})(),function(){function t(){this.x=0,this.renderX=-1e3,this.y=0,this.width=0,this.height=0,this.xMax=0,this.xVel=0,this.jankiness=0,this.loop=!0,this.active=!0,this.sprite=null}var e,n;t.load=function(){return n?n:n=Q.fcall(function(){var t=Q.defer(),e=new Image;return e.onload=function(){t.resolve(e)},e.onerror=function(){t.reject(e)},e.src="static/imgs/ships.png",t.promise}).then(function(t){return e=[[97,100,0,0],[88,75,7,114],[70,91,17,204],[92,95,3,310]].map(function(e){var n=document.createElement("canvas");return n.width=e[0]+2,n.height=e[1]+2,n.getContext("2d").drawImage(t,e[2],e[3],e[0],e[1],1,1,e[0],e[1]),n}),!0})},t.random=function(){return t.fromSprite(Math.floor(Math.random()*e.length))},t.fromSprite=function(n){var i=e[n],r=new t;return r.sprite=i,r.width=i.width,r.height=i.height,r};var i=t.prototype;i.tick=function(t){this.x=this.x+this.xVel*t/1e3,this.x>this.xMax&&(this.loop?this.x=this.x%this.xMax-100:this.active=!1),(!this.jankiness||1>Math.random()+this.jankiness)&&(this.renderX=this.x)},i.draw=function(t){t.drawImage(this.sprite,this.renderX,this.y)},ji.Ship=t}(),function(){function t(){this.width=0,this.height=0,this.duration=500,this.active=!1,this._opacity=0,this._timeRemaining=0,this._colorStr=""}var e=t.prototype;e.flash=function(t,e,n){this._colorStr=t+","+e+","+n+",",this._timeRemaining=this.duration,this.active=!0},e.tick=function(t){this._timeRemaining-=t,0>=this._timeRemaining?this.active=!1:this._opacity=.5*(this._timeRemaining/this.duration)},e.draw=function(t){t.fillStyle="rgba("+this._colorStr+this._opacity+")",t.fillRect(0,0,this.width,this.height)},ji.Flash=t}(),function(){function t(){this.stageWidth=0,this.stageHeight=0,this.active=!1,this.needsResolving=null,this.x=0,this.y=0,this.leftShotPoints=Array(8),this.rightShotPoints=Array(8),this._remaining=0,this._leftShotLen=0,this._leftShotAngle=0,this._rightShotLen=0,this._rightShotAngle=0}var e=300,n=300,i=t.prototype;i.fire=function(t,e){this.x=t,this.y=e,this._remaining=n,this.active=!0;var i=e-this.stageHeight/2;this._leftShotLen=Math.sqrt(t*t+i*i),this._leftShotAngle=Math.atan2(i,t),this._rightShotLen=Math.sqrt(Math.pow(this.stageWidth-t,2)+i*i),this._rightShotAngle=Math.atan2(i,this.stageWidth-t)},i.tick=function(t){if(this._remaining-=t,0>=this._remaining)this.needsResolving=!0,this.active=!1;else{var i=1-Math.pow(this._remaining/n,3),r=Math.max(2*i-1,0),o=this._leftShotLen*r,s=this._rightShotLen*r,a=this._leftShotLen*i,h=this._rightShotLen*i,u=(1-r)*e/2,c=(1-i)*e/2;this.leftShotPoints[0]=o*Math.cos(this._leftShotAngle),this.leftShotPoints[1]=o*Math.sin(this._leftShotAngle)+u+this.stageHeight/2,this.leftShotPoints[2]=this.leftShotPoints[0],this.leftShotPoints[3]=o*Math.sin(this._leftShotAngle)-u+this.stageHeight/2,this.leftShotPoints[4]=a*Math.cos(this._leftShotAngle),this.leftShotPoints[5]=a*Math.sin(this._leftShotAngle)-c+this.stageHeight/2,this.leftShotPoints[6]=this.leftShotPoints[4],this.leftShotPoints[7]=a*Math.sin(this._leftShotAngle)+c+this.stageHeight/2,this.rightShotPoints[0]=this.stageWidth-s*Math.cos(this._rightShotAngle),this.rightShotPoints[1]=s*Math.sin(this._rightShotAngle)+u+this.stageHeight/2,this.rightShotPoints[2]=this.rightShotPoints[0],this.rightShotPoints[3]=s*Math.sin(this._rightShotAngle)-u+this.stageHeight/2,this.rightShotPoints[4]=this.stageWidth-h*Math.cos(this._rightShotAngle),this.rightShotPoints[5]=h*Math.sin(this._rightShotAngle)-c+this.stageHeight/2,this.rightShotPoints[6]=this.rightShotPoints[4],this.rightShotPoints[7]=h*Math.sin(this._rightShotAngle)+c+this.stageHeight/2}},i.draw=function(t){t.fillStyle="rgba(255, 50, 0, 1)",t.beginPath(),t.moveTo(this.leftShotPoints[0],this.leftShotPoints[1]),t.lineTo(this.leftShotPoints[2],this.leftShotPoints[3]),t.lineTo(this.leftShotPoints[4],this.leftShotPoints[5]),t.lineTo(this.leftShotPoints[6],this.leftShotPoints[7]),t.closePath(),t.moveTo(this.rightShotPoints[0],this.rightShotPoints[1]),t.lineTo(this.rightShotPoints[2],this.rightShotPoints[3]),t.lineTo(this.rightShotPoints[4],this.rightShotPoints[5]),t.lineTo(this.rightShotPoints[6],this.rightShotPoints[7]),t.closePath(),t.fill()},ji.Shot=t}(),function(){function t(){this.x=0,this.y=0,this.xVel=0,this.yVel=0,this.active=!1,this.width=28,this.height=28,this.friction=0,this.sprite=null,this.opacity=1,this.fadeTime=600,this.timeTillFade=300,this.activeTime=0,this.scale=1}function e(){this.x=0,this.y=0,this.active=!1,this._particles=[];for(var e=o+s;e--;)this._particles[e]=new t}var n,i,r=t.prototype;r.tick=function(t){this.activeTime+=t,this.x+=this.xVel*t/1e3,this.y+=this.yVel*t/1e3,this.yVel*=1-this.friction,this.xVel*=1-this.friction,this.activeTime>this.timeTillFade+this.fadeTime?this.active=!1:this.activeTime>this.timeTillFade&&(this.opacity=1-(this.activeTime-this.timeTillFade)/this.fadeTime)};var o=400,s=200;e.load=function(){return n?n:n=Q.fcall(function(){var t=Q.defer(),e=new Image;return e.onload=function(){t.resolve(e)},e.onerror=function(){t.reject(e)},e.src="static/imgs/particle-sprites.png",t.promise}).then(function(t){return i=[[28,28,3,3],[28,28,37,3],[28,28,75,3]].map(function(e){var n=document.createElement("canvas");
return n.width=e[0]+2,n.height=e[1]+2,n.getContext("2d").drawImage(t,e[2],e[3],e[0],e[1],1,1,e[0],e[1]),n}),!0})};var a=e.prototype,h=Math.PI/4,u=0,c=500;a.tick=function(t){var e;this.active=!1;for(var n=this._particles.length;n--;)e=this._particles[n],e.active&&(e.tick(t),e.active&&!this.active&&(this.active=!0))},a.start=function(t){var e,n,r,s=Math.random()*Math.PI;this.active=!0;for(var a=this._particles.length;a--;)e=this._particles[a],r=o>a?s+(Math.random()*h-h/2):Math.random()*Math.PI,n=(Math.pow(Math.random(),3)*(c-u)+u)*(Math.round(Math.random())?-1:1),e.x=t.x+t.width/2,e.y=t.y+t.height/2,e.xVel=Math.cos(r)*n,e.yVel=Math.sin(r)*n,e.friction=.05*Math.random(),e.sprite=i[Math.round(.7*Math.random())?t.jankiness?2:0:1],e.opacity=1,e.active=!0,e.activeTime=0,e.fadeTime=400+300*Math.random(),e.scale=.9*Math.random()+.1,e.tick(50)},a.draw=function(t){var e;t.globalCompositeOperation="lighter";for(var n=this._particles.length;n--;)e=this._particles[n],t.globalAlpha=e.opacity,t.drawImage(e.sprite,0,0,e.width,e.height,e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.width*e.scale,e.height*e.scale);t.globalCompositeOperation="source-over",t.globalAlpha=1},ji.Explosion=e}(),function(){function t(t){this.normalShips=50,this.jankyShips=10,this.speed=100,this.speedVariance=50,this.jankiness=.2,this._canvas=t,this._context=t.getContext("2d"),this._ships=[],this._shot=new ji.Shot,this._explosions=[new ji.Explosion,new ji.Explosion],this._flash=new ji.Flash,this._pendingClick=null,this._warpAway=!1,this._scoreTime=0,this._innocentsKilled=0,this._timeEl=document.querySelector(".level-ui .time .num"),this._remainingEl=document.querySelector(".level-ui .spies .num"),this._onCanvasClick=this._onCanvasClick.bind(this)}var e=t.prototype=Object.create(EventEmitter.prototype);e.play=function(){for(var t,e=1e3,n=this.normalShips+this.jankyShips;n--;){t=ji.Ship.random();do t.y=Math.random()*(this._canvas.height-t.height-80),t.x=-t.width-Math.random()*this._canvas.width,e&&e--;while(e&&this._getIntersectingShip(t.x,t.y,t.width,t.height));t.xMax=this._canvas.width,t.xVel=this.speed+Math.random()*2*this.speedVariance-this.speedVariance,t.jankiness=this.jankyShips>n?this.jankiness:0,this._ships.push(t)}this._shot.stageWidth=this._canvas.width,this._shot.stageHeight=this._canvas.height,this._flash.width=this._canvas.width,this._flash.height=this._canvas.height,this._canvas.addEventListener("touchstart",this._onCanvasClick),this._canvas.addEventListener("mousedown",this._onCanvasClick),this._remainingEl.textContent=this.jankyShips,this._timeEl.textContent="0:00.000",this._gameLoop()},e._end=function(){this._canvas.removeEventListener("touchstart",this._onCanvasClick),this._canvas.removeEventListener("mousedown",this._onCanvasClick),this.trigger("end",{time:this._scoreTime,innocentsKilled:this._innocentsKilled})},e._getIntersectingShip=function(t,e,n,i){for(var r,o=this._ships.length;o--;)if(r=this._ships[o],r.active&&r.x+r.width>t&&r.y+r.height>e&&t+n>r.x&&e+i>r.y)return r;return null},e._gameLoop=function(){function t(r){var o,s,a,h=r-e,u=!1;for(e=r,i.clearRect(0,0,n._canvas.width,n._canvas.height),n._pendingClick&&(n._shot.active||n._shot.fire(n._pendingClick.clientX,n._pendingClick.clientY),n._pendingClick=null),n._flash.active&&(n._flash.tick(h),n._flash.active&&n._flash.draw(i)),a=0,len=n._ships.length;len>a;a++)o=n._ships[a],o.active&&(n._warpAway&&(o.xVel*=1.05),o.tick(h),o.active&&(u=!0,o.draw(i)));if(n._shot.active&&(n._shot.tick(h),n._shot.active&&(u=!0,n._shot.draw(i))),n._shot.needsResolving){if(o=n._getIntersectingShip(n._shot.x,n._shot.y,1,1),o&&(o.active=!1,s=n._explosions[n._explosions[0].active?1:0],s.start(o),o.jankiness?(n.jankyShips--,n._flash.flash(0,180,0),n._remainingEl.textContent=n.jankyShips):(n.normalShips--,n._innocentsKilled++,n._flash.flash(255,0,0),n._scoreTime+=1e4),!n.jankyShips||!n.normalShips))for(n._warpAway=!0,a=0,len=n._ships.length;len>a;a++)n._ships[a].loop=!1;n._shot.needsResolving=!1}for(a=0,len=n._explosions.length;len>a;a++)s=n._explosions[a],s.active&&(s.tick(h),s.active&&(u=!0,s.draw(i)));n.jankyShips&&(n._scoreTime+=h,n._timeEl.textContent=ji.utils.formatTime(n._scoreTime)),u?requestAnimationFrame(t):n._end()}var e,n=this,i=n._context;requestAnimationFrame(function(n){e=n,requestAnimationFrame(t)})},e._onCanvasClick=function(t){this._pendingClick=t.touches?t.touches[0]:t,t.preventDefault()},ji.Level=t}(),function(){function t(){var t=this;this._el=document.querySelector(".intro"),this.active=!1,this._goodShips=[0,1,2,3].map(function(t){return ji.Ship.fromSprite(t)}),this._badShips=[0,1,2,3].map(function(t){return ji.Ship.fromSprite(t)}),this._goodCanvas=this._el.querySelector(".good-guys"),this._badCanvas=this._el.querySelector(".bad-guys"),this._el.querySelector(".begin").addEventListener("click",function(e){t.active&&(t.active=!1,t.hide().then(function(){t.trigger("gamestart")})),e.preventDefault()})}var e=t.prototype=Object.create(EventEmitter.prototype);e.show=function(){this._el.style.display="block";var t=this._el.parentNode,e=t.offsetWidth,n=t.offsetHeight,i=this._el.offsetWidth,r=this._el.offsetHeight,o=this;this._goodCanvas.width=this._goodCanvas.offsetWidth,this._goodCanvas.height=this._goodCanvas.offsetHeight,this._badCanvas.width=this._badCanvas.offsetWidth,this._badCanvas.height=this._badCanvas.offsetHeight;var s="translate("+Math.floor(e/2-i/2)+"px, "+-r+"px)",a="translate("+Math.floor(e/2-i/2)+"px, "+Math.floor(n/2-r/2)+"px)";ji.utils.css(this._el,"transform",s),ji.utils.transition(this._el,{transform:a},1,"easeOutQuint").then(function(){o._animShips()}),this.active=!0},e._animShips=function(){function t(t){s-=t.width,t.x=s,t.y=i._goodCanvas.height/2-t.height/2,t.xMax=i._goodCanvas.width,t.xVel=100,s-=20}function e(t){var s,a=t-n;n=t,r.clearRect(0,0,i._goodCanvas.width,i._goodCanvas.height),o.clearRect(0,0,i._badCanvas.width,i._badCanvas.height);for(var h=i._goodShips.length;h--;)s=i._goodShips[h],s.tick(a),s.draw(r);for(h=i._badShips.length;h--;)s=i._badShips[h],s.tick(a),s.draw(o);i.active&&requestAnimationFrame(e)}var n,i=this,r=this._goodCanvas.getContext("2d"),o=this._badCanvas.getContext("2d"),s=0;this._goodShips.forEach(t),s=0,this._badShips.forEach(function(e){t(e),e.jankiness=.2}),requestAnimationFrame(function(t){n=t,requestAnimationFrame(e)})},e.hide=function(){var t=this,e=this._el.parentNode,n=e.offsetWidth,i=e.offsetHeight,r=this._el.offsetWidth;this._el.offsetHeight;var o="translate("+(n/2-r/2)+"px, "+(i+2)+"px)";return ji.utils.transition(this._el,{transform:o},.5,"easeInQuad").then(function(){t._el.style.display="none"})},ji.Intro=t}(),function(){function t(){var t=this;this._el=document.querySelector(".summary"),this._timeEl=this._el.querySelector(".time"),this._msgEl=this._el.querySelector(".msg"),this._qrEl=this._el.querySelector(".qr"),this._el.querySelector(".restart").addEventListener("click",function(e){t.active&&(t.active=!1,t.hide().then(function(){t.trigger("restart")})),e.preventDefault()})}var e=t.prototype=Object.create(EventEmitter.prototype);e.show=function(t){this._el.style.display="block";var e=this._el.parentNode,n=ji.utils.formatTime(t.time);this._timeEl.textContent=n,this._msgEl.textContent=t.innocentsKilled>10?"Traitor! You destroyed more of your own fleet than the janky spies!":t.innocentsKilled>4?"Hmm, you took out quite a few of your own ships. You need to be better at spotting jank.":15e3>t.time?"Wow! That's better than the author of the game ever managed! You're a gifted individual!":2e4>t.time?"Brilliant, you're one of the best! You need to be a few seconds quicker to be the very best though.":3e4>t.time?"A damn fine effort captain! I'm sure you can shave another 5 seconds off that though.":4e4>t.time?"Pretty good, you've got an eye for this. Could be faster, but you're on the right track!":5e4>t.time?"You've got potential, a bit more training and you'll be ready for battle.":8e4>t.time?"Not bad for a first go. It is your first go right? Do it in half the time, then we're talking.":12e4>t.time?"Well, you know what you're doing, you're just not doing it very fast.":"I assume you fell asleep half way through?";var i=qrcode(8,"L");i.addData("https://twitter.com/intent/tweet?text="+encodeURIComponent("I completed the Jank-Invaders Chrome experiment in "+n)+"&"+"url="+encodeURIComponent("http://jakearchibald.github.io/jank-invaders/")),i.make(),this._qrEl.innerHTML=i.createImgTag(4,0);var r=e.offsetWidth,o=e.offsetHeight,s=this._el.offsetWidth,a=this._el.offsetHeight;this._el.style.left=r/2-s/2+"px",this._el.style.top=o/2-a/2+"px",this._el.style.opacity="0",ji.utils.css(this._el,"transform","scale(2)"),ji.utils.transition(this._el,{transform:"scale(1)",opacity:"1"},.4,"easeOutQuint"),this.active=!0},e.hide=function(){var t=this;return ji.utils.transition(this._el,{transform:"scale(0.1)",opacity:"0"},.2,"easeInQuad").then(function(){t._el.style.display="none"})},ji.Summary=t}(),function(){var t=document.querySelector(".level-canvas");t.width=t.offsetWidth,t.height=t.offsetHeight;var e=document.querySelector(".container");e.style.width=t.width+"px",e.style.height=t.height+"px",Q.all([ji.Ship.load(),ji.Explosion.load()]).then(function(){var e=new ji.Intro,n=new ji.Summary;e.on("gamestart",function(){var e=new ji.Level(t);e.play(),e.on("end",function(t){n.show(t)})}),n.on("restart",function(){e.show()}),e.show()})}();
//@ sourceMappingURL=all.js.map